#!/bin/bash

# Copyright 2014 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2014 Naha Maggu <maggu.neha@gmail.com>

[ -f testing.sh ] && . testing.sh

# TODO: Don't hard-code system paths here.  "which" doesn't work because PATH
# is altered by the test harness.
system_tar=/bin/tar
# The test compares it against the system bzcat.
system_zcat=/bin/zcat

# testing "name" "command" "result" "infile" "stdin"

echo "hello" > file
$system_tar -czf file.gz file

$system_zcat file.gz > expected_out
testing "decompresses a single file" \
  'zcat file.gz > Tempfile && echo yes; diff Tempfile expected_out && echo yes' \
  "yes\nyes\n" "" ""

echo "one" > file1
echo "two" > file2
echo "three" > file3

$system_tar -czf file1.gz file1
$system_tar -czf file2.gz file2
$system_tar -czf file3.gz file3

$system_zcat file1.gz file2.gz file3.gz > expected_out
testing "decompresses multiple files" \
  'zcat file1.gz file2.gz file3.gz > Tempfile && echo yes; diff Tempfile expected_out && echo yes' \
  "yes\nyes\n" "" ""
