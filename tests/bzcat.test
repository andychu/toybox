#!/bin/bash

# Copyright 2014 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2014 Naha Maggu <maggu.neha@gmail.com>

[ -f testing.sh ] && . testing.sh


# BUG: Test is wrong!  File does not exist!!

#testing "name" "command" "result" "infile" "stdin"
testing "overflow" \
  'bzcat "$TOPDIR/files/bzcat/overflow.bz2" >/dev/null 2>/dev/null;
   [ $? -eq 1 ] && echo good' "good\n" "" ""

# PROBLEM:
# "make test" -- toybox tar is in path
# "make test_foo" -- tar is not in generated/testdir; system tar is in path!!!

echo "TOPDIR = $TOPDIR"
echo "PATH = $PATH"
tar --version

echo "hello" > file
tar -cjf file.tar.bz2 file
# Get system bzcat
bzcatExe=`which bzcat`
$bzcatExe file.tar.bz2 > bzcatOut
testing "- decompresses a single file" "bzcat file.tar.bz2 > Tempfile && echo "yes"; diff Tempfile bzcatOut && echo "yes"; rm -rf file* bzcatOut Tempfile" "yes\nyes\n" "" ""

#testing "name" "command" "result" "infile" "stdin"
echo "hello" > file1
echo "hi" > file2
echo "Hi, Good morning !! I am a bzcat tester" > file3
tar -cjf file1.tar.bz2 file1
tar -cjf file2.tar.bz2 file2
tar -cjf file3.tar.bz2 file3
# Get system bzcat
bzcatExe=`which bzcat`
$bzcatExe file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > bzcatOut
testing "- decompresses multiple files" "bzcat file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > Tempfile && echo "yes" ; diff Tempfile bzcatOut && echo "yes"; rm -rf file* bzcatOut Tempfile " "yes\nyes\n" "" ""
