#!/bin/bash

# Copyright 2014 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2014 Naha Maggu <maggu.neha@gmail.com>

[ -f testing.sh ] && . testing.sh

#testing "name" "command" "result" "infile" "stdin"

testing "overflow" \
  'bzcat "$TOPDIR/tests/files/bzcat/overflow.bz2" 2>&1; echo $?' \
  "bzcat: bad data\n1\n" "" ""

# TODO: Don't hard-code system paths here.

# "which" doesn't work because PATH is altered by the test harness.
system_tar=/bin/tar
# The test compares it against the system bzcat.
system_bzcat=/bin/bzcat

echo "hello" > file
$system_tar -cjf file.tar.bz2 file

$system_bzcat file.tar.bz2 > expected_out
testing "decompresses a single file" \
  'bzcat file.tar.bz2 > Tempfile && echo "yes"; diff Tempfile expected_out && echo "yes"' \
  "yes\nyes\n" "" ""

echo "hello" > file1
echo "hi" > file2
echo "Hi, Good morning !! I am a bzcat tester" > file3

$system_tar -cjf file1.tar.bz2 file1
$system_tar -cjf file2.tar.bz2 file2
$system_tar -cjf file3.tar.bz2 file3

$system_bzcat file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > expected_out
testing "decompresses multiple files" \
  'bzcat file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > Tempfile && echo "yes" ; diff Tempfile expected_out && echo "yes"' \
  "yes\nyes\n" "" ""

