#!/bin/bash

# Copyright 2014 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2014 Naha Maggu <maggu.neha@gmail.com>

[ -f testing.sh ] && . testing.sh

#testing "name" "command" "result" "infile" "stdin"

testing "overflow" \
  'bzcat "$TOPDIR/tests/files/bzcat/overflow.bz2" 2>&1; echo $?' \
  "bzcat: bad data\n1\n" "" ""

echo "hello" > file
$HOST_BIN_TAR -cjf file.tar.bz2 file

$HOST_BIN_BZCAT file.tar.bz2 > expected_out

testing "decompresses a single file" \
  'bzcat file.tar.bz2 > Tempfile && echo yes; diff Tempfile expected_out && echo yes' \
  "yes\nyes\n" "" ""

echo "one" > file1
echo "two" > file2
echo "three" > file3

$HOST_BIN_TAR -cjf file1.tar.bz2 file1
$HOST_BIN_TAR -cjf file2.tar.bz2 file2
$HOST_BIN_TAR -cjf file3.tar.bz2 file3

$HOST_BIN_BZCAT file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > expected_out

testing "decompresses multiple files" \
  'bzcat file1.tar.bz2 file2.tar.bz2 file3.tar.bz2 > Tempfile && echo yes; diff Tempfile expected_out && echo yes' \
  "yes\nyes\n" "" ""
