#!/bin/bash

# Copyright 2014 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2014 Naha Maggu <maggu.neha@gmail.com>

[ -f testing.sh ] && . testing.sh

# TODO: Don't hard-code system paths here.  "which" doesn't work because PATH
# is altered by the test harness.
system_tar=/bin/tar
# The test compares it against the system bzcat.
# TODO: On Ubuntu, xzcat is in /usr/bin, while zcat is in /bin.
system_xzcat=/usr/bin/xzcat

#testing "name" "command" "result" "infile" "stdin"

echo "hello" > file
tar -cJf file.xz file

$system_xzcat file.xz > expected_out
testing "decompresses a single file" \
  'xzcat file.xz > Tempfile && echo yes; diff Tempfile expected_out && echo yes; rm -rf file* expected_out Tempfile' \
  "yes\nyes\n" "" ""

echo "one" > file1
echo "two" > file2
echo "three" > file3

tar -cJf file1.xz file1
tar -cJf file2.xz file2
tar -cJf file3.xz file3

$system_xzcat file1.xz file2.xz file3.xz > expected_out

testing "decompresses multiple files" \
  'xzcat file1.xz file2.xz file3.xz > Tempfile && echo yes; diff Tempfile expected_out && echo yes' \
  "yes\nyes\n" "" ""
