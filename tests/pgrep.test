# Copyright 2013 Divya Kothari <divya.s.kothari@gmail.com>
# Copyright 2013 Robin Mittal <robinmittal.it@gmail.com>

# Clean up other 'yes' processes.  TODO: Don't mess with the host system.
killall yes

# Starting processes to test pgrep command
yes >/dev/null &

pid=$!
echo "PID $pid started"

sleep 0.1

parent_pid=$(awk '{ print $4 }' /proc/$pid/stat)
echo "Parent of process $pid is $parent_pid"

#testing "name" "command" "result" "infile" "stdin"

testing "pattern" "pgrep yes" "$pid\n" "" ""
testing "wildCardPattern" "pgrep ^y.*s$" "$pid\n" "" ""
testing "-l pattern" "pgrep -l yes" "$pid yes\n" "" ""
testing "-f pattern" "pgrep -f yes" "$pid\n" "" ""
testing "-n pattern" "pgrep -n yes" "$pid\n" "" ""
testing "-o pattern" "pgrep -o yes" "$pid\n" "" ""
testing "-P" "pgrep -P $parent_pid yes" "$pid\n" "" ""

# NOTE: Fails with pgrep: bad -s '0'
testing "-s" "pgrep -s 0 yes" "$pid\n" "" ""

# Cleanup
kill $pid
